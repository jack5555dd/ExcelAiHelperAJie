{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Excel AI Command Protocol",
  "description": "严格的Excel操作命令协议，确保AI响应100%可执行",
  "type": "object",
  "required": ["version", "commands"],
  "additionalProperties": false,
  "properties": {
    "version": {
      "type": "string",
      "enum": ["1.0"],
      "description": "协议版本号"
    },
    "summary": {
      "type": "string",
      "maxLength": 200,
      "description": "操作摘要，简要描述将要执行的操作"
    },
    "commands": {
      "type": "array",
      "minItems": 1,
      "maxItems": 10,
      "description": "要执行的命令列表",
      "items": {
        "$ref": "#/definitions/command"
      }
    }
  },
  "definitions": {
    "command": {
      "type": "object",
      "required": ["function", "arguments"],
      "additionalProperties": false,
      "properties": {
        "function": {
          "type": "string",
          "enum": [
            "setCellValue",
            "applyCellFormula",
            "setCellStyle",
            "setCellFormat",
            "clearCellContent",
            "insertRows",
            "insertColumns",
            "deleteRows",
            "deleteColumns",
            "sortRange",
            "filterRange",
            "createChart",
            "copyRange",
            "pasteRange",
            "findReplace"
          ],
          "description": "要执行的函数名"
        },
        "arguments": {
          "type": "object",
          "description": "函数参数，根据function类型有不同的schema要求"
        },
        "description": {
          "type": "string",
          "maxLength": 100,
          "description": "操作描述"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "function": {
                "const": "setCellValue"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/setCellValueArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "applyCellFormula"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/applyCellFormulaArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "setCellStyle"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/setCellStyleArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "setCellFormat"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/setCellFormatArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "clearCellContent"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/clearCellContentArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "insertRows"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/insertRowsArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "insertColumns"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/insertColumnsArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "deleteRows"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/deleteRowsArgs"
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "function": {
                "const": "deleteColumns"
              }
            }
          },
          "then": {
            "properties": {
              "arguments": {
                "$ref": "#/definitions/deleteColumnsArgs"
              }
            }
          }
        }
      ]
    },
    "setCellValueArgs": {
      "type": "object",
      "required": ["range", "value"],
      "additionalProperties": false,
      "properties": {
        "range": {
          "$ref": "#/definitions/cellRange"
        },
        "value": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "number"
            },
            {
              "type": "boolean"
            }
          ],
          "description": "要设置的值"
        },
        "dataType": {
          "type": "string",
          "enum": ["text", "number", "boolean", "date", "auto"],
          "default": "auto",
          "description": "数据类型提示"
        }
      }
    },
    "applyCellFormulaArgs": {
      "type": "object",
      "required": ["range", "formula"],
      "additionalProperties": false,
      "properties": {
        "range": {
          "$ref": "#/definitions/cellRange"
        },
        "formula": {
          "type": "string",
          "pattern": "^=.+",
          "description": "Excel公式，必须以=开头"
        }
      }
    },
    "setCellStyleArgs": {
      "type": "object",
      "required": ["range"],
      "additionalProperties": false,
      "properties": {
        "range": {
          "$ref": "#/definitions/cellRange"
        },
        "backgroundColor": {
          "$ref": "#/definitions/color"
        },
        "fontColor": {
          "$ref": "#/definitions/color"
        },
        "bold": {
          "type": "boolean"
        },
        "italic": {
          "type": "boolean"
        },
        "underline": {
          "type": "boolean"
        },
        "fontSize": {
          "type": "integer",
          "minimum": 6,
          "maximum": 72
        },
        "fontName": {
          "type": "string",
          "enum": ["Arial", "Calibri", "Times New Roman", "宋体", "微软雅黑", "黑体"]
        }
      }
    },
    "setCellFormatArgs": {
      "type": "object",
      "required": ["range", "format"],
      "additionalProperties": false,
      "properties": {
        "range": {
          "$ref": "#/definitions/cellRange"
        },
        "format": {
          "type": "string",
          "enum": [
            "General",
            "0",
            "0.00",
            "0.000",
            "#,##0",
            "#,##0.00",
            "0%",
            "0.00%",
            "yyyy-mm-dd",
            "mm/dd/yyyy",
            "hh:mm:ss",
            "¥#,##0.00",
            "$#,##0.00"
          ],
          "description": "Excel数字格式代码"
        }
      }
    },
    "clearCellContentArgs": {
      "type": "object",
      "required": ["range"],
      "additionalProperties": false,
      "properties": {
        "range": {
          "$ref": "#/definitions/cellRange"
        },
        "clearType": {
          "type": "string",
          "enum": ["content", "format", "all"],
          "default": "content",
          "description": "清除类型：内容、格式或全部"
        }
      }
    },
    "insertRowsArgs": {
      "type": "object",
      "required": ["position"],
      "additionalProperties": false,
      "properties": {
        "position": {
          "type": "integer",
          "minimum": 1,
          "description": "插入位置的行号"
        },
        "count": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 1,
          "description": "插入行数"
        }
      }
    },
    "insertColumnsArgs": {
      "type": "object",
      "required": ["position"],
      "additionalProperties": false,
      "properties": {
        "position": {
          "type": "string",
          "pattern": "^[A-Z]+$",
          "description": "插入位置的列标识（如A、B、C）"
        },
        "count": {
          "type": "integer",
          "minimum": 1,
          "maximum": 50,
          "default": 1,
          "description": "插入列数"
        }
      }
    },
    "deleteRowsArgs": {
      "type": "object",
      "required": ["range"],
      "additionalProperties": false,
      "properties": {
        "range": {
          "type": "string",
          "pattern": "^\\d+:\\d+$",
          "description": "要删除的行范围，如1:3表示删除第1到3行"
        }
      }
    },
    "deleteColumnsArgs": {
      "type": "object",
      "required": ["range"],
      "additionalProperties": false,
      "properties": {
        "range": {
          "type": "string",
          "pattern": "^[A-Z]+:[A-Z]+$",
          "description": "要删除的列范围，如A:C表示删除A到C列"
        }
      }
    },
    "cellRange": {
      "type": "string",
      "pattern": "^([A-Z]+\\d+(:[A-Z]+\\d+)?|[A-Z]+:[A-Z]+|\\d+:\\d+|CURRENT_SELECTION)$",
      "description": "Excel单元格范围，支持A1、A1:B5、A:A、1:1或CURRENT_SELECTION"
    },
    "color": {
      "type": "string",
      "oneOf": [
        {
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "十六进制颜色代码，如#FF0000"
        },
        {
          "enum": [
            "red", "green", "blue", "yellow", "orange", "purple", 
            "pink", "gray", "grey", "black", "white", "brown",
            "cyan", "magenta", "lime", "navy", "maroon", "olive"
          ],
          "description": "预定义颜色名称"
        }
      ]
    }
  }
}